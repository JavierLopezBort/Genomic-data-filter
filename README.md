The aim of this project is calculate and compare contemporary (nucleotide diversity or pi) and historical (temporal change in allele frequencies) effective population size in Anopheles coluzzii and Anopheles gambiae using autosomes and sex chromosomes. Therefore, the population size of the Anopheles mosquito is estimated using both methods. I have used genetic data from the MalariaGEN database (The Anopheles gambiae 1000 Genomes Consortium, 2021, https://www.malariagen.net/data/ag1000g-phase3-snp). However, it is not possible to estimate directly the population size using the enormous genetic information so several filters must be applied to select only the loci that are of interest for our study. For this purpose, some codes have been developed in Phyton and R.

First, from the database of MalariaGEN, some filters must be applied to the genomic data to obtain databases with useful information. This part has been done by Brenas, Jon and Hui, Tin-Yu and its script in Python using Jupyter Notebook can be found here: https://github.com/tinyuhui/AG3. From this database, you can download a hdf5 file which contains four types of information: the genotype of each base pair or locus, the position of each base pair or locus, the sample id of each sampled mosquito and the metadata. In addition, the genomic data has been filtered. The loci included in the TCAF (temporary change in allele frequencies) method are SNPs (without fixed sites) that have the following filters: biallelic, intergenic, without missing sites. Using the nucleotide diversity method you it is also included the fixed sites. For this reason, you obtain files with different information depending on the method. Finally, you can select the chromosome which you want to study (X, 3R, 3L, 2R, 2L). However, in the script we will only use chr X as an example.

When the hdf5 file and the metadata file are downloaded, the first one has to be recoded. This means that genotypes are coded like this: 00, 01 and 11, but we need to convert them to 0, 1 and 2 in order to calculate properly the allele frequencies. To do this we used the recode_genotypes_X.R and Rside.c files, which can be found in this repository. The first one loads the hdf5 file and export two files: genomic_X_TCAF.RData and genomic_X_pi.RData, which can be also found in this repository. The second one is zipped in the file genomic_X_pi.zip due to its large size. Finally, recode_genotypes_X.R and Rside.c have been coded by Hui, Tin-Yu and the second file has to be compiled in order to obtain the Rside.dll file, which is the one that we need in recode_genotypes_X.R file.
When we obtain the genomic_X_TCAF.R and genomic_X_pi.RD files, we need to apply more filters but in this case will be done in R and all the files from now are located in this repository except of the estimation of population size using TCAF method.

First, we will explain the genomic_X_pi.R file. Using it, we load other two files: genomic_X_pi.RData and metadata.csv. The first one contains genotype, position and sample_ID and the second one information about the sample ID. First, we filter the sample_id obtaining only the samples coluzzi 2012 and gambiae 2012 using the metadata.csv file. With these sample_ids we can filter the genotypes and obtaining two filtered genotypes: genotype_col_2012 and genotype_gamb_2012. Now, we do a sliding window analysis to both species in order to find the higher recombination regions. To do this, we divide the entire chr X in X windows of 100,000 bp. Then, we calculate the allele frequencies of each part in order to estimate the nucleotide diversity or pi of each window. Doing this, we obtain a vector of nucelotide diversity or pi and we can plot it using the middle position of each window. Analysing the plot, we can conlucde that after position 12,5 Mb nucleotide diversity or pi decreases, so the higher recombination regions are located between the position 1 and position 12,5 Mb in bot species (coluzzi and gambiae). Then, in order to avoid linkage disequilibrium, we take only one gene per 1000 bp positions from the POS data. Doing this, we obtain one new filtered position: POS_link. Note that with this filter we are only taking the positions located in the higher recombination regions. We have observed this in the previous step. Knowing the filtered positions we can again filter the genotypes, obtaining new two filtered genotypes: genotype_col_2012_link, genotype_gamb_2012_link. Finally, with these two filtered genotypes we can estimate populatin size using the formula: pi/4*_mu (mu is the mutation rate = 2.8e-9)

Now we will explain the genomic_X_TCAF.R file. Using it, we load other two files: genomic_X_TCAF.RData and metadata.csv. The first one contains genotype, position and sample_ID and the second one information about the sample ID. First, we filter the sample_id obtaining only the samples coluzzii 2012, 2014 and gambiae 2012, 2014 using the metadata.csv file. With these sample_ids we can filter the genotypes and obtaining four genotypes: genotype_col_2012, genotype_col_2014, genotype_gamb_2012 and genotype_gamb_2014. Then we estimate the allele frequencies using the genotypes and their sample sizes (number of sampled mosquitoes). Knowing the allele frequencies, we exclude the genes with MAF > 0.05 (minor allele frequency must be higher than 5 %). Finally, only the genes with MAF > 0.05 found in both samples of the same specie (2012 and 2014 coluzzii and 2012 and 2014 gambiae respectively) have been taken. With this filter, we obtained four new filtered genotypes: genotype_col_2012_MAF_c, genotype_col_2014_MAF_c, genotype_gamb_2012_MAF_c and genotype_gamb_2014_MAF_c. We also filter the Position because we know the genes with a MAF > 0.05, obtaining two new filtered positions: POS_col and POS_gambiae. Then, in order to avoid linkage disequilibrium, we take only one gene per 1000 bp positions from the POS filtered data. Doing twice (one per specie), we obtain two new filtered positions: POS_col_link and POS_gamb_link. Note that with this filter we are only taking the positions located in the higher recombination regions. We have observed in the previous method that the higher recombination regions are located between the position 1 and position 12,5 Mb in the chr X. Knowing the filtered positions we can again filter the genotypes, obtaining new four filtered genotypes: genotype_col_2012_link, genotype_col_2014_link, genotype_gamb_2012_link, genotype_gamb_2014_link. Finally, these six data (two final filtered positions and four final filtered genotypes) are exported in the genomic_X_TCAF_filter.RData. This file can be loaded in the Script.R file, located in the repository "temporal_Ne_linked" of Hui, Tin-Yu (https://github.com/tinyuhui/temporal_Ne_linked.git), in order to estimate the historical population size using the temporary change in allele frequencies method.

